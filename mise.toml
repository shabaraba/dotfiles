# mise project configuration for dotfiles repository
# This file defines tool versions for development work on dotfiles itself

[tools]
node = "22"      # LTS (Jod) - supported until April 2027
python = "3.13"  # Latest stable - supported until 2029
go = "latest"
pnpm = "latest"  # Package manager - minimum 10.27.0

# =============================================================================
# Dotfiles Management Tasks
# =============================================================================

[tasks.deploy]
description = "Deploy dotfiles symlinks to home directory"
run = "sh deployer.sh"

[tasks."dotfiles:update"]
description = "Update dotfiles from git and redeploy"
run = """
git pull origin main
sh deployer.sh
"""

[tasks."dotfiles:status"]
description = "Show git status of dotfiles"
run = "git status"

# =============================================================================
# System Maintenance Tasks
# =============================================================================

[tasks."brew:update"]
description = "Update Homebrew and all packages"
run = """
brew update
brew upgrade
brew cleanup
"""

[tasks."brew:dump"]
description = "Update Brewfile with currently installed packages"
run = "brew bundle dump --force --describe --file=installers/Brewfile"

[tasks."brew:check"]
description = "Check if all Brewfile packages are installed"
run = "brew bundle check --file=installers/Brewfile"

[tasks."cache:clean"]
description = "Clean system caches"
run = """
echo "Cleaning Homebrew cache..."
brew cleanup -s
echo "Cleaning npm cache..."
npm cache clean --force 2>/dev/null || true
echo "Cleaning Python cache..."
find . -type d -name '__pycache__' -exec rm -rf {} + 2>/dev/null || true
echo "Done!"
"""

# =============================================================================
# Utility Tasks
# =============================================================================

[tasks.myip]
description = "Show my public IP address"
run = "curl -s ifconfig.me && echo"

[tasks.ports]
description = "List all listening ports"
run = "lsof -i -P | grep LISTEN"

[tasks."dns:flush"]
description = "Flush DNS cache (macOS)"
run = """
sudo dscacheutil -flushcache
sudo killall -HUP mDNSResponder
echo "DNS cache flushed"
"""

[tasks."git:cleanup"]
description = "Clean up merged git branches"
run = """
echo "Deleting merged branches..."
git branch --merged | grep -v '\\*\\|main\\|master\\|develop' | xargs -n 1 git branch -d
echo "Done!"
"""

[tasks.sysinfo]
description = "Show system information"
run = """
echo "=== System Info ==="
echo "OS: $(uname -s) $(uname -r)"
echo "Node: $(node -v 2>/dev/null || echo 'not installed')"
echo "Python: $(python --version 2>/dev/null || echo 'not installed')"
echo "mise: $(mise --version)"
echo "Homebrew: $(brew --version | head -n 1)"
"""
